# Docker env

> create ubntu container
> sudo apt install maven



# 資料庫設定
> 確認本機的 ip 位置

``` 
# DataSource配置
spring.datasource.url=jdbc:mysql://本機ip:3306/(dbname)?characterEncoding=utf-8
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.jpa.hibernate.ddl-auto=update

```
# POM 依賴設定
> 加入 Spring-jpa && MySQL 依賴
``` xml
	<dependency>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-data-jpa</artifactId>
	</dependency>

	<dependency>
		<groupId>mysql</groupId>
		<artifactId>mysql-connector-java</artifactId>
		<scope>runtime</scope>
	</dependency>
```
# 新增資料庫實體對象
> 添加 @Entity 標註

> name和img沒有任何標註，由於ImageNode添加了@Entity標註，它們會被映射為同名的資料表欄位。

> ImageNode對象的成員都是private的，所以還需要為它們加上Getter/Setter方法
``` java
@Entity // This tells Hibernate to make a table out of this class
public class ImageNode {
	@Id
	@GeneratedValue(strategy=GenerationType.AUTO)
	private Integer id;

	private String name;

	private String img;
}
```

# CrudRepository的接口
``` java
public interface CrudRepository<T, ID extends Serializable>
  extends Repository<T, ID> {
 
    <S extends T> S save(S entity);
 
    T findOne(ID primaryKey);
 
    Iterable<T> findAll();
 
    Long count();
 
    void delete(T entity);
 
    boolean exists(ID primaryKey);
}
```
> 範例
``` java
public interface ImageNodeRepository extends CrudRepository<ImageNode, Integer> {
	List<ImageNode> findByName(String name);
	List<ImageNode> findByImg(String img);
}
```
# 新增 API

``` java
	@Autowired // This means to get the bean called ImageNodeRepository
			   // Which is auto-generated by Spring, we will use it to handle the data
	private ImageNodeRepository imageNodeRepository;

	@GetMapping(path="/add")
	public @ResponseBody String addImageNode (@RequestParam String name
			, @RequestParam String img) {
		// @ResponseBody means the returned String is the response, not a view name
		// @RequestParam means it is a parameter from the GET or POST request

		ImageNode n = new ImageNode();
		n.setName(name);
		n.setImg(img);
		imageNodeRepository.save(n);
		return "Save Successfully";
	}

	@GetMapping(path="/del")
	public @ResponseBody String delImageNode (@RequestParam Integer id) {

		ImageNode n = new ImageNode();
		n.setId(id);
		imageNodeRepository.delete(n);
		return "Del Successfully";
	}

	@GetMapping(path="/update")
	public @ResponseBody String updateImageNode (@RequestParam String name
			, @RequestParam String img, @RequestParam Integer id) {

		ImageNode n = new ImageNode();
		n.setId(id);
		n.setName(name);
		n.setImg(img);
		imageNodeRepository.save(n);
		return "Update Successfully";
	}

	@GetMapping(path="/get")
	public @ResponseBody ImageNode getImageNode (@RequestParam Integer id) {

		return imageNodeRepository.findById(id).get();
	}

	@GetMapping(path="/all")
	public @ResponseBody Iterable<ImageNode> getAllImageNode() {
		// This returns a JSON or XML with the users
		return imageNodeRepository.findAll();
	}
```

```
import org.springframework.web.bind.annotation.CrossOrigin;

@CrossOrigin(origins="*")


import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.builder.SpringApplicationBuilder;
import org.springframework.boot.webservlet.support.SpringBootServletInitializer;

@SpringBootApplication
public class Javaweb101Application extends SpringBootServletInitializer {

    @Override
    protected SpringApplicationBuilder configure(SpringApplicationBuilder application) {
        return application.sources(Javaweb101Application.class);
    }

    public static void main(String[] args) throws Exception {
        SpringApplication.run(Javaweb101Application.class, args);
    }

}

<packaging>war</packaging>

<dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-tomcat</artifactId>
            <scope>provided</scope>
</dependency>
```



